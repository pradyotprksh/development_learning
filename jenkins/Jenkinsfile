pipeline {
    agent any

    environment {
        ANDROID_SCRIPT = '../../scripts/android_script.py'
        KOTLIN_SCRIPT = '../../../scripts/kotlin_script.py'
        RUST_SCRIPT = '../../scripts/rust_script.py'
    }

    stages {
        stage('Projects Checkup') {
            steps {
                script {
                    def projectDirs = sh(script: 'ls -d ./*/ | tr -d \'/\'', returnStdout: true).trim().split('\n')

                    // Run stages dynamically for each project directory
                    for (def projectDir in projectDirs) {
                        stage("${projectDir} project") {
                            steps {
                                dir("./${projectDir}") {
                                    script {
                                        if (projectDir.contains('android')) {
                                            sh "python3 ${env.ANDROID_SCRIPT}"
                                        } else if (projectDir.contains('kotlin')) {
                                            sh "python3 ${env.KOTLIN_SCRIPT}"
                                        } else if (projectDir.contains('rust')) {
                                            sh "python3 ${env.RUST_SCRIPT}"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
