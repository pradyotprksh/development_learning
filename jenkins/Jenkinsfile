pipeline {
    agent any

    environment {
        ANDROID_SCRIPT = '../../scripts/android_script.py'
        KOTLIN_SCRIPT = '../../../scripts/kotlin_script.py'
        RUST_SCRIPT = '../../scripts/rust_script.py'
    }

    stages {
        stage('Projects Checkup') {
            steps {
                script {
                    def projectDirs = sh(script: 'ls -d ./*/ | tr -d \'/\'', returnStdout: true).trim().split('\n')
                    for (def projectDir in projectDirs) {
                        if (projectDir.contains('android')) {
                            stage("${projectDir} Project") {
                                steps {
                                    dir("./${projectDir}") {
                                        sh "python3 ${env.ANDROID_SCRIPT}"
                                    }
                                }
                            }
                        }
                        if (projectDir.contains('kotlin')) {
                            stage("${projectDir} Project") {
                                steps {
                                    dir("./${projectDir}") {
                                        sh "python3 ${env.KOTLIN_SCRIPT}"
                                    }
                                }
                            }
                        }
                        if (projectDir.contains('rust')) {
                            stage("${projectDir} Project") {
                                steps {
                                    dir("./${projectDir}") {
                                        sh "python3 ${env.KOTLIN_SCRIPT}"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
